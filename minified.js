function sphere(x,y,z,size){return Math.sqrt(x*x+y*y+z*z)-size}function draw(){for(t+=.1,i=0,eyeX=W/2,eyeY=H/2,eyeZ=-40,x=0;x<W;x++)for(y=0;y<H;y++){var dx=x-eyeX,dy=y-eyeY,dz=0-eyeZ,len=Math.sqrt(dx*dx+dy*dy+dz*dz),rayDirection=[dx/len,dy/len,dz/len];rx=eyeX,ry=eyeY,rz=eyeZ;for(var hit=!1,step=0,it=0;rz<255;){it++;var dist=1e7;for(var b in boxes)dist=Math.min(dist,sphere(rx-boxes[b][0]+90*Math.cos(t),ry-boxes[b][1],rz-boxes[b][2],50));if(5>dist){hit=!0;break}step+=dist,rx=eyeX+rayDirection[0]*step,ry=eyeY+rayDirection[1]*step,rz=eyeZ+rayDirection[2]*step}i=4*(x+y*W),hit?(pixels[i+0]=255,pixels[i+1]=it/2,pixels[i+2]=255,pixels[i+3]=255):(pixels[i+0]=0,pixels[i+1]=0,pixels[i+2]=0,pixels[i+3]=255)}c.putImageData(imageData,0,0)}t=0,W=a.width/=4,H=a.height/=4,imageData=c.createImageData(W,H),pixels=imageData.data,boxes=[[100,50,100],[350,50,100]],setInterval(draw,16);