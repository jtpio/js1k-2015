function cube(x,y,z,size){return Math.sqrt(x*x+y*y+z*z)-40}function draw(){for(t+=.1,i=0,eyeX=W/2,eyeY=H/2,eyeZ=-40,x=0;x<W;x++)for(y=0;y<H;y++){var dx=x-eyeX,dy=y-eyeY,dz=0-eyeZ,mul=2,len=Math.sqrt(dx*dx+dy*dy+dz*dz)/mul,rayUnit=[dx/len,dy/len,dz/len];rx=eyeX,ry=eyeY,rz=eyeZ,step=0;for(var hit=!1,dist=1e4,it=0;rz<255;){if(it++,dist=cube(rx-cubePos[0]+90*Math.cos(t),ry-cubePos[1],rz-cubePos[2],50),10>dist){hit=!0;break}step+=1,rx=eyeX+dx*step,ry=eyeY+dy*step,rz=eyeZ+dz*step}i=4*(x+y*W),hit?(pixels[i+0]=255,pixels[i+1]=50*it,pixels[i+2]=0,pixels[i+3]=255):(pixels[i+0]=0,pixels[i+1]=255,pixels[i+2]=0,pixels[i+3]=255)}c.putImageData(imageData,0,0)}t=0,W=a.width/=4,H=a.height/=4,imageData=c.createImageData(W,H),pixels=imageData.data,cubePos=[100,50,50],setInterval(draw,16);